@model OXDesk.Core.Auth.DTOs.AuthorizeViewModel
@{
    ViewData["Title"] = "Sign In";
    Layout = "_Layout";
}

<div class="d-flex min-vh-100 align-items-center justify-content-center bg-body-tertiary p-3 p-md-5">
    <div class="w-100" style="max-width: 24rem;">
        <div class="card shadow-sm overflow-hidden border-0">
            <div class="card-body p-4 p-md-4 d-flex flex-column gap-2">
                <div class="text-center mb-3">
                    <!-- Application Logo -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" viewBox="0 0 24 24">
                        <defs>
                            <style>.cls-1{fill:#47a6e3;}.cls-2{fill:#f55fa6;}.cls-3{fill:#da3380;}.cls-4{fill:#0e7cc9;}.cls-5{fill:#6c2e7c;}</style>
                        </defs>
                        <g id="Icons">
                            <rect class="cls-1" height="9" rx="2" width="9" x="1" y="1"/>
                            <rect class="cls-2" height="9" rx="2" width="9" x="14" y="1"/>
                            <rect class="cls-3" height="9" rx="2" width="9" x="1" y="14"/>
                            <rect class="cls-4" height="9" rx="2" width="9" x="14" y="14"/>
                            <path class="cls-2" d="M10,16a2.006,2.006,0,0,1-2,2H3a2,2,0,0,1,0-4H8A2.006,2.006,0,0,1,10,16Z"/>
                            <path class="cls-1" d="M23,16a2.006,2.006,0,0,1-2,2H16a2,2,0,0,1,0-4h5A2.006,2.006,0,0,1,23,16Z"/>
                        </g>
                        <g data-name="Layer 4" id="Layer_4">
                            <path class="cls-5" d="M8,0H3A3,3,0,0,0,0,3V8a3,3,0,0,0,3,3H8a3,3,0,0,0,3-3V3A3,3,0,0,0,8,0ZM9,8A1,1,0,0,1,8,9H3A1,1,0,0,1,2,8V3A1,1,0,0,1,3,2H8A1,1,0,0,1,9,3Z"/>
                            <path class="cls-5" d="M21,0H16a3,3,0,0,0-3,3V8a3,3,0,0,0,3,3h5a3,3,0,0,0,3-3V3A3,3,0,0,0,21,0Zm1,8a1,1,0,0,1-1,1H16a1,1,0,0,1-1-1V3a1,1,0,0,1,1-1h5a1,1,0,0,1,1,1Z"/>
                            <path class="cls-5" d="M8,13H3a3,3,0,0,0-3,3v5a3,3,0,0,0,3,3H8a3,3,0,0,0,3-3V16A3,3,0,0,0,8,13Zm1,8a1,1,0,0,1-1,1H3a1,1,0,0,1-1-1V16a1,1,0,0,1,1-1H8a1,1,0,0,1,1,1Z"/>
                            <path class="cls-5" d="M21,13H16a3,3,0,0,0-3,3v5a3,3,0,0,0,3,3h5a3,3,0,0,0,3-3V16A3,3,0,0,0,21,13Zm1,8a1,1,0,0,1-1,1H16a1,1,0,0,1-1-1V16a1,1,0,0,1,1-1h5a1,1,0,0,1,1,1Z"/>
                        </g>
                    </svg>
                    <h5 class="mt-3 mb-1">Sign in to OXDesk</h5>
                </div>

                @if (!string.IsNullOrEmpty(Model.Error))
                {
                    <div class="alert alert-danger py-2 small" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-1"></i>
                        @Model.Error
                    </div>
                }

                <form method="post" action="/oauth/authorize" class="d-flex flex-column gap-3" novalidate>
                    @Html.AntiForgeryToken()
                    <input type="hidden" asp-for="Login.ReturnUrl" value="@Model.ReturnUrl" />
                    @* Include OAuth parameters as hidden fields so OpenIddict can process them *@
                    @foreach (var param in Context.Request.Query)
                    {
                        <input type="hidden" name="@param.Key" value="@param.Value" />
                    }
                    
                    <div asp-validation-summary="ModelOnly" class="text-danger small"></div>

                    <div class="form-group">
                        <label asp-for="Login.Email" class="form-label">Email</label>
                        <input asp-for="Login.Email" class="form-control" placeholder="name@example.com" autocomplete="email" />
                        <span asp-validation-for="Login.Email" class="text-danger small"></span>
                    </div>

                    <div class="form-group">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <label asp-for="Login.Password" class="form-label mb-0">Password</label>
                        </div>
                        <input asp-for="Login.Password" type="password" class="form-control" autocomplete="current-password" />
                        <span asp-validation-for="Login.Password" class="text-danger small"></span>
                    </div>

                    <div class="form-check">
                        <input asp-for="Login.RememberMe" class="form-check-input" type="checkbox" />
                        <label asp-for="Login.RememberMe" class="form-check-label small">
                            Remember me
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-box-arrow-in-right me-1"></i>
                        Sign In
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

@functions {
    string GetScopeDescription(string scope)
    {
        return scope switch
        {
            "openid" => "Verify your identity",
            "profile" => "Access your profile information",
            "email" => "Access your email address",
            "offline_access" => "Stay signed in",
            "api" => "Access OXDesk API on your behalf",
            _ => scope
        };
    }
}
